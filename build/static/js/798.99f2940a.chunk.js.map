{"version":3,"file":"static/js/798.99f2940a.chunk.js","mappings":"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","sources":["components/PredictionCounter/index.tsx","components/PredictionModal/index.tsx","apps/prediction/index.tsx","components/GameItem/index.tsx","components/GamesList/index.tsx","helpers/format-date.ts","helpers/get-games-by-groups.ts","../node_modules/@babel/runtime/helpers/esm/defineProperty.js","../node_modules/@babel/runtime/helpers/esm/objectSpread2.js"],"sourcesContent":["import './PredictionCounter.sass';\n\ntype PredictionCounterProps = {\n  disabled: boolean;\n  onInc: () => void;\n  onDec: () => void;\n};\n\nfunction PredictionCounter({\n  disabled,\n  onInc,\n  onDec,\n}: PredictionCounterProps) {\n  return (\n    <div className=\"prediction-counter\">\n      <div\n        className=\"prediction-counter__btn prediction-counter__btn--inc\"\n        onClick={onInc}\n      >+</div>\n      <div\n        className={`prediction-counter__btn prediction-counter__btn--dec${disabled ? ' disabled': ''}`}\n        onClick={() => !disabled && onDec()}\n      >-</div>\n    </div>\n  );\n}\n\nexport default PredictionCounter;\n","import React from \"react\";\nimport { Game } from \"../../types\";\nimport GameItem from \"../GameItem\";\nimport PredictionCounter from \"../PredictionCounter\";\nimport './PredictionModal.sass';\n\ntype PredictionModalProps = {\n  game: Game | null;\n  onScoreChange: (score: number[]) => void;\n  onClose: () => void;\n  bottom: JSX.Element | boolean;\n};\n\nfunction PredictionModal({\n  game,\n  bottom,\n  onScoreChange,\n  onClose,\n}: PredictionModalProps) {\n  const [homeScore, setHomeScore] = React.useState(0);\n  const [awayScore, setAwayScore] = React.useState(0);\n\n  React.useEffect(() => {\n    onScoreChange([homeScore, awayScore]);\n  }, [homeScore, awayScore]);\n\n  React.useEffect(() => {\n    document.body.style.overflow = game ? 'hidden' : 'auto';\n  }, [game]);\n\n  function closeModal() {\n    onClose();\n    setHomeScore(0);\n    setAwayScore(0);\n  }\n\n  return (\n    <div\n      className={`prediction-modal-wrapper ${game ? 'opened' : 'closed'}`}\n      onClick={closeModal}\n    >\n      <div\n        className=\"prediction-modal\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <div className=\"prediction-modal-header\">\n          <PredictionCounter\n            disabled={homeScore === 0}\n            onInc={() => setHomeScore(s => s + 1)}\n            onDec={() => setHomeScore(s => s - 1)}\n          />\n          {game && <GameItem\n            game={{...game, score: [homeScore, awayScore]}}\n          />}\n          <PredictionCounter\n            disabled={awayScore === 0}\n            onInc={() => setAwayScore(s => s + 1)}\n            onDec={() => setAwayScore(s => s - 1)}\n          />\n        </div>\n        {bottom && <div className=\"prediction-modal-bottom\">\n          {bottom}\n        </div>}\n      </div>\n    </div>\n  );\n}\n\nexport default PredictionModal;\n","import React from 'react';\nimport api from '../../api';\nimport GameItem from '../../components/GameItem';\nimport GamesList from '../../components/GamesList';\nimport PredictionModal from '../../components/PredictionModal';\nimport { ByKeys, getGamesByGroups } from '../../helpers/get-games-by-groups';\nimport { Game, TgUser } from '../../types';\nimport './styles.sass';\n\nfunction PredictionAppLoading() {\n  return <h1>Загрузка...</h1>;\n}\n\nfunction PredictionAppError() {\n  return <h2>Произошла ошибка (<br/>Попробуйте позже.</h2>;\n}\n\ntype AppProps = {\n  tg: any;\n  user: TgUser;\n};\n\nfunction PredictionApp({ tg, user }: AppProps) {\n  const [loading, setLoading] = React.useState(true);\n  const [error, setError] = React.useState(false);\n  const [predictionError, setPredictionError] = React.useState(false);\n  const [gamesByGroups, setGamesByGroups] = React.useState<ByKeys<ByKeys<Game[]>>>({});\n\n  React.useEffect(() => {\n    tg.ready();\n    tg.expand();\n    api.getGamesForUser({ userId: user.id })\n      .then(games => setGamesByGroups(getGamesByGroups(games)))\n      .catch(_ => setError(true))\n      .finally(() => setLoading(false));\n  }, []);\n\n  const [score, setScore] = React.useState([0, 0]);\n\n  const [activeGame, setActiveGame] = React.useState<Game | null>(null);\n\n  React.useEffect(() => {\n    if(activeGame) {\n      tg.MainButton.text = 'Подтвердить';\n      tg.MainButton.show();\n    }\n    else {\n      tg.MainButton.hide();\n    }\n  }, [activeGame]);\n\n  React.useEffect(() => {\n    if(activeGame)\n      tg.MainButton.onClick(applyPrediction);\n    \n    return () => {\n      tg.MainButton.offClick(applyPrediction);\n    }\n  }, [activeGame, score]);\n\n  function selectGame(game: Game) {\n    setActiveGame(game);\n  }\n\n  async function applyPrediction() {\n    const options = {\n      userId: user.id,\n      gameId: activeGame!.id,\n      prediction: score,\n    };\n    try {\n      tg.MainButton.showProgress();\n      await api.createPrediction(options);\n      tg.close();\n    } catch(err) {\n      setPredictionError(true);\n    } finally {\n      tg.MainButton.hideProgress();\n    }\n  }\n\n  let content;\n  if(loading) {\n    content = <PredictionAppLoading />\n  } else if(error) {\n    content = <PredictionAppError />\n  } else {\n    content = Object.entries(gamesByGroups).map(([groupName, gamesByTours]) => {\n      return (<>\n        <h2>{groupName}</h2>\n        {Object.entries(gamesByTours).map(([tourName, games]) => {\n          return (<>\n            <h3>{tourName}</h3>\n            <GamesList>\n              {games.map(game => {\n                return (\n                  <GameItem\n                    key={game.id}\n                    game={game}\n                    onClick={() => selectGame(game)}\n                  />\n                );\n              })}\n            </GamesList>\n          </>);\n        })}\n      </>);\n    });\n  }\n\n  return (\n    <div id=\"prediction-app\">\n      {content}\n      <PredictionModal\n        game={activeGame}\n        onScoreChange={setScore}\n        onClose={() => setActiveGame(null)}\n        bottom={predictionError && <div className=\"prediction-error\">Произошла ошибка. Попробуйте еще раз.</div>}\n      />\n    </div>\n  );\n}\n\nexport default PredictionApp;\n","import { formatDate } from '../../helpers/format-date';\nimport { Game } from '../../types';\nimport './GameItem.sass';\n\ntype PredictionGamesListItemProps = {\n  game: Game;\n  onClick?: () => void;\n}\nfunction GameItem({\n  game,\n  onClick,\n}: PredictionGamesListItemProps) {\n  return (\n    <div\n      className={`game${onClick ? ' clickable' : ''}`}\n      onClick={() => onClick && onClick()}\n    >\n      <div className=\"game__time\">\n        {formatDate(+game.time)}\n      </div>\n      <div className=\"game__logos\">\n        {game.teams_logos.map((src, i) => {\n          return <img key={i} src={src} alt={game.teams[i]} />\n        })}\n        {game.score && game.score.map((score, i) => {\n          return <div key={i} className={`game__score game__score--${i ? 'away' : 'home'}`}>\n            {score}\n          </div>\n        })}\n      </div>\n      <div className=\"game__teams\">\n        {game.teams.map((team, i) => {\n          return <div key={i} className=\"game__team\">\n            {team}\n          </div>\n        })}\n      </div>\n    </div>\n  );\n}\n\nexport default GameItem;\n","import './GamesList.sass';\n\ntype PredictionGamesListProps = {\n  children: JSX.Element[];\n};\n\nfunction GamesList({\n  children\n}: PredictionGamesListProps){\n  return (\n    <div className=\"games-list\">\n      {children}\n    </div>\n  );\n}\n\nexport default GamesList;\n","export function formatDate(time: number): string {\n  const date = new Date(time);\n  const dw = ['ПН','ВТ','СР','ЧТ','ПТ','СБ','ВС'][date.getDay()];\n  const d = date.getDate();\n  const m = date.getMonth() + 1;\n  const h = date.getHours();\n  const min = date.getMinutes();\n\n  const f = (v: number) => v >= 10 ? `${v}` : `0${v}`;\n\n  return `${dw} · ${f(d)}.${f(m)} · ${f(h)}:${f(min)}`;\n}\n","import { Game } from \"../types\";\n\nexport type ByKeys<ValueType> = { [key: string]: ValueType };\n\nfunction getGamesByKey(key: keyof Game, games: Game[]): ByKeys<Game[]> {\n  return games.reduce((o, game) => {\n    const k = game[key] as string;\n    if(!o[k]) return { ...o, [k]: [game] };\n    else return { ...o, [k]: o[k].concat([game]) };\n  }, {} as ByKeys<Game[]>);\n}\n\nexport function getGamesByGroups(games: Game[]): ByKeys<ByKeys<Game[]>> {\n  const byGroups = getGamesByKey('group', games);\n  const byGroupsEntries = Object.entries(byGroups)\n    .map(([key, games]) => ([key, getGamesByKey('tour', games)]));\n  return Object.fromEntries(byGroupsEntries);\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","import defineProperty from \"./defineProperty.js\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nexport default function _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}"],"names":["disabled","onInc","onDec","className","onClick","game","bottom","onScoreChange","onClose","React","homeScore","setHomeScore","awayScore","setAwayScore","document","body","style","overflow","e","stopPropagation","s","GameItem","score","PredictionAppLoading","PredictionAppError","tg","user","loading","setLoading","error","setError","predictionError","setPredictionError","gamesByGroups","setGamesByGroups","ready","expand","api","userId","id","then","games","getGamesByGroups","catch","_","finally","content","setScore","activeGame","setActiveGame","applyPrediction","options","gameId","prediction","MainButton","showProgress","close","hideProgress","text","show","hide","offClick","Object","entries","map","groupName","gamesByTours","tourName","GamesList","selectGame","formatDate","time","teams_logos","src","i","alt","teams","team","children","date","Date","dw","getDay","d","getDate","m","getMonth","h","getHours","min","getMinutes","f","v","getGamesByKey","key","reduce","o","k","concat","byGroups","byGroupsEntries","fromEntries","_defineProperty","obj","value","defineProperty","enumerable","configurable","writable","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","push","apply","_objectSpread2","target","arguments","length","source","forEach","getOwnPropertyDescriptors","defineProperties"],"sourceRoot":""}